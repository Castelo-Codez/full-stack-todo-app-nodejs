import{$removeError,$setError}from"./globalfuntions.js";const $table=document.querySelector("table"),$noItemsSpan=document.querySelector("section .container > span"),$accountButton=document.querySelector("#Account"),$toggleMenu=document.querySelector("#toggle-menu"),$form=document.querySelector("form");null==$accountButton||$accountButton.addEventListener("click",e=>{"false"===$accountButton.ariaExpanded?$accountButton.ariaExpanded="true":$accountButton.ariaExpanded="false",e.stopPropagation(),null==$toggleMenu||$toggleMenu.toggleAttribute("expanded")});const $logOutBtn=null==$toggleMenu?void 0:$toggleMenu.querySelector("button");function $appendToTable(todo){var _a;const tr=document.createElement("tr");tr.id=`${todo.id}`;const TodoTitle=document.createElement("td");TodoTitle.textContent=todo.title;const TodoId=document.createElement("td");TodoId.textContent=`${todo.id}`;const createdAt=document.createElement("td");createdAt.textContent=todo.createdAt;const status=document.createElement("td");status.innerHTML=`<div class="form-check form-switch">\n  <input class="form-check-input" type="checkbox" role="switch" id='${todo.id}'>\n</div>\n    `;const statusToggle=status.querySelector("input");null==statusToggle||statusToggle.addEventListener("change",e=>{axios.post("/todos/update-status",{status:e.target.checked,id:e.target.id})});const deleteBtnTd=document.createElement("td");deleteBtnTd.innerHTML='<button type=\'button\' aria-label=\'remove todo\' id=\'removeTodo\' role=\'button\'><svg fill="#ffffff" width="25px" height="25px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M5.755,20.283,4,8H20L18.245,20.283A2,2,0,0,1,16.265,22H7.735A2,2,0,0,1,5.755,20.283ZM21,4H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V4H3A1,1,0,0,0,3,6H21a1,1,0,0,0,0-2Z"></path></g></svg></button>';const deleteButton=deleteBtnTd.querySelector("button");deleteButton&&deleteButton.addEventListener("click",e=>{var _a,_b,_c,_d;axios.delete(`/todos/delete-todo/${(null===(_a=deleteButton.parentElement)||void 0===_a?void 0:_a.parentElement)?null===(_b=deleteButton.parentElement)||void 0===_b?void 0:_b.parentElement.id:""}`),null===(_d=null===(_c=deleteButton.parentElement)||void 0===_c?void 0:_c.parentElement)||void 0===_d||_d.remove(),$checkIfTodosEmpty()}),tr.append(TodoTitle,TodoId,createdAt,status,deleteBtnTd),null===(_a=null==$table?void 0:$table.querySelector("tbody"))||void 0===_a||_a.appendChild(tr)}function $appendToServer(todo){axios.post("/todos/add-todo",Object.assign({},todo))}function $checkIfTodosEmpty(){var _a,_b;if(!(null===(_a=null==$table?void 0:$table.querySelector("tbody"))||void 0===_a?void 0:_a.querySelectorAll("tr").length)){const span=document.createElement("span");span.textContent="No Items",null===(_b=null==$table?void 0:$table.parentElement)||void 0===_b||_b.appendChild(span)}}null==$logOutBtn||$logOutBtn.addEventListener("click",e=>{axios.delete("/logout").then(()=>window.location.assign("/login"))}),window.addEventListener("click",e=>{$accountButton&&($accountButton.ariaExpanded="false"),null==$toggleMenu||$toggleMenu.toggleAttribute("expanded",!1)}),null==$toggleMenu||$toggleMenu.addEventListener("click",e=>{e.stopPropagation()}),null==$form||$form.addEventListener("submit",e=>{var _a;e.preventDefault();let $checkTodoErrors={todo:$form.todo.value.length<4?{error:!0,type:"todo",message:"must be at least 4 characters"}:{error:!1,type:"todo"}};for(let[key,value]of Object.entries($checkTodoErrors))"string"!=typeof value&&value.error&&$setError(value),"string"==typeof value||value.error||$removeError(value);if("string"!=typeof $checkTodoErrors.todo&&!$checkTodoErrors.todo.error){const todo={title:$form.todo.value,status:!1,createdAt:(null===(_a=`${new Date}`.match(/\w+\s\w+\s\w+\s\w+:\w+/gi))||void 0===_a?void 0:_a.join())||null,id:Date.now()};null==$noItemsSpan||$noItemsSpan.remove(),$appendToTable(todo),$appendToServer(todo),$form.todo.value=""}}),document.querySelectorAll("input[type='checkbox']").forEach(input=>{input.addEventListener("change",e=>{axios.post("/todos/update-status",{status:e.target.checked,id:e.target.id})})}),null==$table||$table.querySelectorAll("button").forEach($btn=>{$btn.addEventListener("click",e=>{var _a,_b,_c,_d;axios.delete(`/todos/delete-todo/${(null===(_a=$btn.parentElement)||void 0===_a?void 0:_a.parentElement)?null===(_b=$btn.parentElement)||void 0===_b?void 0:_b.parentElement.id:""}`),null===(_d=null===(_c=$btn.parentElement)||void 0===_c?void 0:_c.parentElement)||void 0===_d||_d.remove(),$checkIfTodosEmpty()})});